<!DOCTYPE html>
<html>
<head>
<title>ESP32_rotor_control</title>
</head>
<body style='background-color: #EEEEEE;'>

<span style='color: #003366;'>

<h1>Servo rotation control</h1>

<br>

Set rotation: <br>
<input type='range' min='0' max='360' value='0' class='slider' id='ID_LED_INTENSITY'>
Current value: <span id='ID_LED_INTENSITY_VALUE'>-</span><br>

</span>

</body>
<script>

  var slider = document.getElementById('ID_LED_INTENSITY');
  var output = document.getElementById('ID_LED_INTENSITY_VALUE');
  slider.addEventListener('change', slider_changed);

  var Socket;
  
  function init() {
    Socket = new WebSocket('ws://' + window.location.hostname + ':81/');
    Socket.onmessage = function(event) {
      processCommand(event);
    };
  }
  
  function slider_changed () {
    var l_LED_intensity = slider.value;
    console.log(l_LED_intensity);
    var msg = { 
      type: 'LED_intensity',
      value: l_LED_intensity
    };
    Socket.send(JSON.stringify(msg)); 
  }

  function processCommand(event) {
	  var obj = JSON.parse(event.data);
    var type = obj.type;
    if (type.localeCompare("LED_intensity") == 0) { 
      var l_LED_intensity = parseInt(obj.value); 
      console.log(l_LED_intensity); 
      slider.value = l_LED_intensity; 
      output.innerHTML = l_LED_intensity;
    }
  }
  
  window.onload = function(event) {
    init();
  }
</script>
</html>
